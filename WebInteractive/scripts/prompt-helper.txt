# scripts/prompt-helper.ps1

function Request-Input {
    param(
        [Parameter(Mandatory=$true)]
        [string]$Prompt
    )

    # Write the prompt directly to the console's output stream without a newline.
    # This avoids PowerShell's pipeline buffering, which can hide the prompt.
    [System.Console]::Write($Prompt)
    
    # Immediately write a special token to signal Python that input is needed.
    # We use WriteLine here to ensure it's sent as a complete line.
    [System.Console]::WriteLine("SCRIPT_INPUT_REQUIRED")

    $inputReceived = $false
    $response = ""
    while (-not $inputReceived) {
        # Peek to see if there's data in stdin without consuming it
        if ([System.Console]::In.Peek() -ne -1) {
            # Read a line from stdin
            $response = [System.Console]::In.ReadLine()
            $inputReceived = $true
        } else {
            # Wait a short moment before checking again to prevent busy-waiting
            Start-Sleep -Milliseconds 100
        }
    }
    return $response
}
